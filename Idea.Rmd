---
title: "Project"
output: html_document
date: "2022-11-01"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE,
                      error = TRUE)
                
library(tidyverse)
library(lubridate)
library(kableExtra)
library(readxl)
library(ggplot2)
library(maps)
library(ggridges)

state = data.frame(state = state.abb, region = state.region, 
                   state_name = tolower(state.name))

year_2003 = read_excel("FY2003_50Rents_County.xls") %>% 
    select(state = State_Alpha, rent_03 = rent50_3) %>% 
  inner_join(state) %>% 
  group_by(state, region) %>% 
    summarize(rent_03 = round(mean(rent_03),2)) %>% 
  mutate(year_03 = "2003")

year_2008 = read_excel("FY2008_county_level_50th_r.xls") %>% 
  select(state = state_alpha, rent_08 = Rent50_3) %>%  
  inner_join(state) %>% 
    group_by(state, region) %>% 
    summarize(rent_08 = round(mean(rent_08),2))%>% 
  mutate(year_08 = "2008")

year_2013 = read_excel("FY2013_50_Final.xls")  %>% 
  select(state = state_alpha, rent_13 = Rent50_3) %>%  
  inner_join(state) %>% 
    group_by(state, region) %>% 
    summarize(rent_13 = round(mean(rent_13),2)) %>% 
  mutate(year_13 = "2013")

year_2018 = read_excel("FY2018_50_County_rev.xlsx") %>% 
  select(state = state_alpha, rent_18 = rent50_3) %>%  
  inner_join(state) %>% 
    group_by(state, region) %>% 
    summarize(rent_18 = round(mean(rent_18),2)) %>% 
  mutate(year_18 = "2018")

year_2023 = read_excel("FY2023_FMR_50_county.xlsx") %>% 
  select(state = state_alpha, rent_23 = rent_50_3) %>%  
  inner_join(state) %>% 
    group_by(state, region) %>% 
    summarize(rent_23 = round(mean(rent_23),2)) %>% 
  mutate(year_23 = "2023")

years = year_2023 %>%  full_join(year_2018) %>% full_join(year_2013) %>% full_join(year_2008) %>% full_join(year_2003) %>% 
  select(state, starts_with("r")) %>% 
    pivot_longer(
        cols = starts_with("rent"),
        names_to = "year",
        values_to = "rent")
years[years == "rent_23"] = "2023"
years[years == "rent_18"] = "2018"
years[years == "rent_13"] = "2013"
years[years == "rent_08"] = "2008"
years[years == "rent_03"] = "2003"
```

## R Markdown

```{r}
year_2003 = year_2003 %>%  full_join(state)
states = map_data("state") %>% mutate(state_name = region)    
map = merge(states, year_2003, by = "state_name", all.x = T)  
map_03 = map[order(map$order), ]     
ggplot(map_03, aes(x = long, y = lat, group = group)) +  
    geom_polygon(aes(fill = rent_03)) +   
    geom_path() + 
    scale_fill_gradientn(colors = rev(heat.colors(10))) +
    coord_map() +
    labs(x = "Longitude", y = "Latitude", 
         title = "Rent Prices by State", 
         subtitle = "3 Bedrooms in 2003") +
    guides(fill = guide_legend(title = "Rent Price")) +
  theme_ridges() +
  theme(panel.background = element_blank(),  
    panel.grid = element_blank(), 
    axis.line = element_blank(), 
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    axis.text = element_blank())

year_2008 = year_2008 %>%  full_join(state)
states = map_data("state") %>% mutate(state_name = region)    
map = merge(states, year_2008, by = "state_name", all.x = T)  
map_08 = map[order(map$order), ]     
ggplot(map_08, aes(x = long, y = lat, group = group)) +  
    geom_polygon(aes(fill = rent_08)) +   
    geom_path() + 
    scale_fill_gradientn(colors = rev(heat.colors(10))) +
    coord_map() +
    labs(x = "Longitude", y = "Latitude", 
         title = "Rent Prices by State", 
         subtitle = "3 Bedrooms in 2008") +
    guides(fill = guide_legend(title = "Rent Price")) +
  theme_ridges() +
  theme(panel.background = element_blank(),  
    panel.grid = element_blank(), 
    axis.line = element_blank(), 
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    axis.text = element_blank())

year_2013 = year_2013 %>%  full_join(state)
states = map_data("state") %>% mutate(state_name = region)    
map = merge(states, year_2013, by = "state_name", all.x = T)  
map_13 = map[order(map$order), ]     
ggplot(map_13, aes(x = long, y = lat, group = group)) +  
    geom_polygon(aes(fill = rent_13)) +   
    geom_path() + 
    scale_fill_gradientn(colors = rev(heat.colors(10))) +
    coord_map() +
    labs(x = "Longitude", y = "Latitude", 
         title = "Rent Prices by State", 
         subtitle = "3 Bedrooms in 2013") +
    guides(fill = guide_legend(title = "Rent Price")) +
  theme_ridges() +
  theme(panel.background = element_blank(),  
    panel.grid = element_blank(), 
    axis.line = element_blank(), 
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    axis.text = element_blank())

year_2018 = year_2018 %>%  full_join(state)
states = map_data("state") %>% mutate(state_name = region)    
map = merge(states, year_2018, by = "state_name", all.x = T)  
map_18 = map[order(map$order), ]     
ggplot(map_18, aes(x = long, y = lat, group = group)) +  
    geom_polygon(aes(fill = rent_18)) +   
    geom_path() + 
    scale_fill_gradientn(colors = rev(heat.colors(10))) +
    coord_map() +
    labs(x = "Longitude", y = "Latitude", 
         title = "Rent Prices by State", 
         subtitle = "3 Bedrooms in 2018") +
    guides(fill = guide_legend(title = "Rent Price")) +
  theme_ridges() +
  theme(panel.background = element_blank(),  
    panel.grid = element_blank(), 
    axis.line = element_blank(), 
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    axis.text = element_blank())

year_2023 = year_2023 %>%  full_join(state)
states = map_data("state") %>% mutate(state_name = region)    
map = merge(states, year_2023, by = "state_name", all.x = T)  
map_23 = map[order(map$order), ]     
ggplot(map_23, aes(x = long, y = lat, group = group)) +  
    geom_polygon(aes(fill = rent_23)) +   
    geom_path() + 
    scale_fill_gradientn(colors = rev(heat.colors(10))) +
    coord_map() +
    labs(x = "Longitude", y = "Latitude", 
         title = "Rent Prices by State", 
         subtitle = "3 Bedrooms in 2023") +
    guides(fill = guide_legend(title = "Rent Price")) +
  theme_ridges() +
  theme(panel.background = element_blank(),  
    panel.grid = element_blank(), 
    axis.line = element_blank(), 
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    axis.text = element_blank())  

ggplot(years, aes(x = rent, y = region, fill = region)) +
    geom_density_ridges() +
    facet_grid("year") +
    theme_ridges() +                              
    theme(legend.position = "none",                  
          axis.title.x = element_text(hjust = 0.5),  
          axis.title.y = element_text(hjust = 0.5)) + 
    labs(x = "Rent Price", y = "Region",  
         title = "Rent Prices by Region", subtitle = "3 Bedrooms") 

ggplot(years,aes(year, rent)) + geom_boxplot() + 
    theme_ridges() +
    labs(x = "Year",  y = "Rent Price",
         title = "Rent Prices by Year", subtitle = "3 Bedrooms") 

ggplot(years,aes(rent,region)) + geom_boxplot() + facet_grid(vars(year)) +
    theme_ridges() +
    labs(x = "Rent Price", y = "Region",  
         title = "Rent Prices by Region", subtitle = "3 Bedrooms") 

ggplot(years,aes(year, rent)) + geom_boxplot() + facet_wrap(vars(region)) + 
    theme_ridges() +
    labs(x = "Year", y = "Rent Price",  
         title = "Rent Prices by Year and Region", subtitle = "3 Bedrooms")  
```
```{r}
us.map = map_data('state')

us.map$Region[us.map$region %in% 
                c("alabama","arkansas","delaware","florida","georgia","kentucky",'louisiana','maryland','mississippi','north carolina', 'oklahoma', 'south carolina', 'tennessee', 'texas', 'virginia','west virginia')] = "South"
us.map$Region[us.map$region %in% 
          c('alaska','arizona','california','colorado','hawaii','idaho','montana','nevada','new mexico','oregon','utah','washington','wyoming')] = "West"
us.map$Region[us.map$region %in% 
          c('connecticut','maine','massachusetts','new hampshire','new jersey','new york', 'pennsylvania','rhode island','vermont','district of columbia')] = "Northeast"
us.map$Region[us.map$region %in% 
          c('illinois','indiana','iowa','kansas','michigan','missouri','nebraska','north dakota','ohio','south dakota','wisconsin', 'minnesota')] = "North Central"

states = aggregate(cbind(long, lat) ~ region, data=us.map, 
                FUN=function(x)mean(range(x)))

ggplot(us.map,  aes(x=long, y=lat)) + 
  geom_polygon(aes(group = group, fill=Region),color = 'black')  +
  theme_ridges() +
  ggtitle("US Regions") +
  theme(panel.background = element_blank(),  
    panel.grid = element_blank(), 
    axis.line = element_blank(), 
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    axis.text = element_blank())+
  coord_map() 
```
